generator client {
  provider = "prisma-client-js"
  binaryTargets = ["native", "rhel-openssl-1.0.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model admins {
  id         Int      @id @default(autoincrement())
  username   String   @unique
  password   String
  created_at DateTime @default(now())
}

model firmalar {
  id                    Int      @id @default(autoincrement())
  firma_adi             String
  slug                  String   @unique
  profil_foto           String?
  vcard_dosya           String?
  yetkili_adi           String?
  yetkili_pozisyon      String?
  created_at            DateTime @default(now())
  updated_at            DateTime @default(now())
  goruntulenme          Int      @default(0)
  katalog               String?
  firma_hakkinda        String?
  firma_hakkinda_baslik String?  @default("Hakkımızda")
  firma_unvan           String?
  firma_vergi_no        String?
  vergi_dairesi         String?
  sektor_id             Int?
  kategori_id           Int?
  il_id                 Int?
  ilce_id               Int?
  onay                  Boolean  @default(false)
  tip                   String?
  firma_logo            String?
  template_id           Int      @default(1)

  // İlişkiler
  iletisim_bilgileri    IletisimBilgisi[]
  sosyal_medya_hesaplari SosyalMedyaHesabi[]
  banka_hesaplari       BankaHesabi[]
  
  // Foreign key ilişkileri
  sektor                sektorler?    @relation(fields: [sektor_id], references: [id])
  kategori              kategoriler?  @relation(fields: [kategori_id], references: [id])
  il                    iller?        @relation(fields: [il_id], references: [id])
  ilce                  ilceler?      @relation(fields: [ilce_id], references: [id])
}

// İletişim bilgileri tablosu
model IletisimBilgisi {
  id        Int      @id @default(autoincrement())
  firma_id  Int
  tip       String   // 'telefon', 'eposta', 'whatsapp', 'telegram', 'website', 'harita'
  deger     String   // Telefon numarası, email, URL vb.
  etiket    String?  // Opsiyonel etiket (örn: "İş Telefonu", "Genel Müdür")
  aktif     Boolean  @default(true)
  sira      Int      @default(0) // Gösterim sırası
  created_at DateTime @default(now())
  
  firma     firmalar @relation(fields: [firma_id], references: [id], onDelete: Cascade)
  
  @@index([firma_id])
  @@index([tip])
}

// Sosyal medya hesapları tablosu
model SosyalMedyaHesabi {
  id        Int      @id @default(autoincrement())
  firma_id  Int
  platform  String   // 'instagram', 'facebook', 'twitter', 'linkedin', 'youtube', 'tiktok'
  url       String   // Sosyal medya hesap URL'si
  etiket    String?  // Opsiyonel etiket
  aktif     Boolean  @default(true)
  sira      Int      @default(0) // Gösterim sırası
  created_at DateTime @default(now())
  
  firma     firmalar @relation(fields: [firma_id], references: [id], onDelete: Cascade)
  
  @@index([firma_id])
  @@index([platform])
}

// Banka hesapları tablosu
model BankaHesabi {
  id           Int      @id @default(autoincrement())
  firma_id     Int
  banka_adi    String   // Banka adı (örn: "Ziraat Bankası")
  banka_kodu   String?  // Banka kodu (opsiyonel)
  banka_logo   String?  // Banka logo URL'si
  hesap_sahibi String   // Hesap sahibi adı
  aktif        Boolean  @default(true)
  sira         Int      @default(0) // Gösterim sırası
  created_at   DateTime @default(now())
  
  firma        firmalar @relation(fields: [firma_id], references: [id], onDelete: Cascade)
  hesaplar     BankaHesapDetay[]
  
  @@index([firma_id])
}

// Banka hesap detayları tablosu (bir bankada birden fazla hesap olabilir)
model BankaHesapDetay {
  id              Int      @id @default(autoincrement())
  banka_hesabi_id Int
  iban            String   // IBAN numarası
  para_birimi     String   @default("TRY") // Para birimi (TRY, USD, EUR)
  hesap_turu      String?  // Hesap türü (opsiyonel)
  aktif           Boolean  @default(true)
  created_at      DateTime @default(now())
  
  banka_hesabi    BankaHesabi @relation(fields: [banka_hesabi_id], references: [id], onDelete: Cascade)
  
  @@index([banka_hesabi_id])
  @@index([iban])
}

model Icon {
  id       Int    @id @default(autoincrement())
  name     String
  priority Int
}

model sektorler {
  id       Int        @id @default(autoincrement())
  ad       String
  firmalar firmalar[]
}

model kategoriler {
  id       Int        @id @default(autoincrement())
  ad       String
  firmalar firmalar[]
}

model iller {
  id       Int        @id @default(autoincrement())
  ad       String
  firmalar firmalar[]
  ilceler  ilceler[]
}

model ilceler {
  id       Int        @id @default(autoincrement())
  ad       String
  il_id    Int
  il       iller      @relation(fields: [il_id], references: [id])
  firmalar firmalar[]
  
  @@index([il_id])
}

// Sipariş yönetimi tablosu
model siparisler {
  id              Int      @id @default(autoincrement())
  siparis_no      String   @unique
  paket_id        String   // 'starter', 'business', 'enterprise'
  paket_adi       String   // Paket adı
  template_id     Int      // Seçilen template ID
  template_adi    String   // Template adı
  tutar           Int      // Sipariş tutarı (kuruş cinsinden)
  
  // Fatura bilgileri
  fatura_adi      String   // Ad Soyad / Firma Adı
  vergi_no        String?  // Vergi numarası / TC kimlik
  fatura_adresi   String   // Fatura adresi
  email           String   // E-posta
  telefon         String   // Telefon
  
  // Kartvizit bilgileri (URL'den gelen)
  firma_adi       String?  // Firma adı
  yetkili_adi     String?  // Yetkili adı
  yetkili_pozisyon String? // Pozisyon
  iletisim_telefon String? // İletişim telefonu
  iletisim_eposta String?  // İletişim e-postası
  website         String?  // Website
  instagram       String?  // Instagram
  linkedin        String?  // LinkedIn
  facebook        String?  // Facebook
  
  // Sipariş durumu
  durum           String   @default("beklemede") // 'beklemede', 'odeme_onaylandi', 'kartvizit_olusturuluyor', 'tamamlandi', 'iptal'
  odeme_durumu    String   @default("beklemede") // 'beklemede', 'onaylandi', 'reddedildi'
  
  // Notlar ve açıklamalar
  admin_notu      String?  // Admin notu
  musteri_notu    String?  // Müşteri notu
  
  // Tarihler
  created_at      DateTime @default(now())
  updated_at      DateTime @updatedAt
  odeme_tarihi    DateTime? // Ödeme onay tarihi
  tamamlanma_tarihi DateTime? // Sipariş tamamlanma tarihi
  
  @@index([siparis_no])
  @@index([durum])
  @@index([odeme_durumu])
  @@index([email])
  @@index([created_at])
}
